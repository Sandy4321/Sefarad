

<link rel="import" href="../../bower_components/polymer/polymer.html">
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="dc.leaflet.custom.js"></script>
<script src="sparql-geojson.js"></script>

<polymer-element name="leaflet-map" class="dc-element">

  <template>
    <style>
     :host {
       display: block;
       position: relative;
     }
     #map {
       height: 350px;
     }
    </style>
      <link rel="stylesheet" href="leaflet.css" />

    <div id="map"></div>

  </template>

  <script>
   Polymer({

       crossfilterObject: {},
       chart: {},
       dimension: {},
       group: {},
       geoJSON: {},

       ready: function() {
           console.log("leaflet-map ready");
       },

       crossfilterObjectChanged : function () {
           if(this.crossfilterObject){
               console.log("leaflet-map hooked to crossfilter object: " + this.crossfilterObject);

           }
       },

       init: function () {

//           var baseLayer = L.tileLayer('http://{s}.tiles.mapbox.com/v3/MapID/{z}/{x}/{y}.png', {
//               attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
//               maxZoom: 18
//           });
//
//           var map = new L.Map( this.$.map , {
//               zoom: 18,
//               layers: [baseLayer]
//           } );

           var leafletchart = dc.leafletChoroplethChart("#map", "", new L.Map( this.$.map))
                   .root(this.$.map)//IMPORTANT! this has to be set from this point. If not set, the library will try to use jQuery to find the document's root, wich will fail!
                   .dimension(this.dimension)
                   .group(this.group)
                   .center([42.69,25.42])
                   .zoom(7)
                   .geojson(sparqlToGeoJSON(this.geoJSON, false))
                   .featureKeyAccessor(function(feature) {
                       return feature.properties.id;
                   })
                   .renderPopup(true)
                   .popup(function(d,feature) {
                       return feature.properties.name.value;
                   });



           //dc.renderAll();
       }
   });
  </script>
</polymer-element>
