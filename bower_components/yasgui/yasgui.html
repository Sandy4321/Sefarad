<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at https://polymer.github.io/LICENSE.txt
The complete set of authors may be found at https://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at https://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at https://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">

<dom-module id="yasgui-ui">
  
  <template>

     <style>
      .yasqe {
        z-index: 0;
      }
      .yasr, .yasr_header *{
        z-index: 0;
      }
      paper-menu {
        display: block;
        color: blue;
      }
      paper-dropdown-menu {
        text-align: left;
        margin: auto;
        width: 100%;
        color: blue;
      }
      paper-dropdown-menu.letters {
        width: 90px;
        color: blue;
      }
      paper-menu-button {
        width: 100%;
      }
    </style>
    <paper-dropdown-menu label="Select your query">
            <paper-menu class="dropdown-content" on-iron-select="_itemSelected" selected="1">
              <template is="dom-repeat" items="{{queries}}" as="query">
                <paper-item>[[query.name]]</paper-item>
              </template>
            </paper-menu>
          </paper-dropdown-menu>
    <div id="yasqe"></div>
    <div id="yasr"></div>

  </template>

<script>

  var yasr, yasqe = {};
  Polymer({
      is: 'yasgui-ui',
      properties: {
        query: {
          type: String,
          observer: '_queryValueChanged'
        },
        endpoint: {
          type: String,
          observer: '_endpointChanged'
        },
        queries: {
          type: Array,
          value: [
            {name:'All landlocked countries with a population greater than 15 million.', val:'PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  \nPREFIX type: <http://dbpedia.org/class/yago/> \nPREFIX prop: <http://dbpedia.org/property/> \n\nSELECT ?country_name ?population WHERE { \n   ?country a type:LandlockedCountries ; \n   rdfs:label ?country_name ; \n   prop:populationEstimate ?population . \n   FILTER (?population > 15000000) .\n}'},
            {name:'Population and abstract of New York', val:'PREFIX schema: <http://schema.org/> \nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> \nPREFIX dbpedia-owl: <http://dbpedia.org/ontology/> \nPREFIX dbpprop: <http://dbpedia.org/property/>\nSELECT DISTINCT ?city ?abstract ?pop\n\nWHERE {\n   ?city rdf:type schema:City ; \n     rdfs:label ?label ; \n     dbpedia-owl:abstract ?abstract ; \n     dbpedia-owl:country ?country ; \n     dbpedia-owl:populationTotal ?pop . \n   ?country dbpprop:countryCode "USA"@en . \n   FILTER ( lang(?abstract) = "en" && regex(?label, "New York City")) \n }'}
          ]
        }
      },
      ready: function() {
        YASQE.defaults.value = "PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>  \nPREFIX type: <http://dbpedia.org/class/yago/> \nPREFIX prop: <http://dbpedia.org/property/> \n\nSELECT ?country_name ?population WHERE { \n   ?country a type:LandlockedCountries ; \n   rdfs:label ?country_name ; \n   prop:populationEstimate ?population . \n   FILTER (?population > 15000000) .\n}";

        yasr = YASR(this.$.yasr);
        yasqe = YASQE(this.$.yasqe, {
        sparql: {
          showQueryButton: true,
          endpoint: 'http://dbpedia.org/sparql'
        } 
        });
        /**
        * Set some of the hooks to link YASR and YASQE
        */
        yasr.options.getUsedPrefixes = yasqe.getPrefixesFromQuery;
        yasqe.options.sparql.callbacks.complete = yasr.setResponse;

        if (!yasr.storage.get("yasr_showcase_results"))  yasqe.query();
      },
      /**
      * Change the query value when it has chan
      */
      _itemSelected: function(e){
        for(var i = 0; i < this.queries.length; i++){
          if(this.queries[i].name == e.target.selectedItem.innerText){
            this.query = this.queries[i].val
          }
        }
      },
      _queryValueChanged: function(){
        yasqe.setValue(this.query)
      },
      _endpointChanged: function(){
        //Structure build
      }
    });
</script>
</dom-module>